<ion-view view-title="Proposal" cache-view="false">
    <nav class="navbar navbar-default navbar-fixed">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Proposal</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-left">
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li class="card" style="box-shadow: none; margin-top:15px;">
              <img class="avatar border-gray" src="{{proposal.accountPicture()}}" alt="..."/>
            </li>
            <li>
              <a href="#!/login" ng-click="proposal.logout()">Log out</a>
            </li>
            <li class="separator hidden-lg"></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="content">
      <div class="container-fluid">
        <form name="editProposalForm">
        <div class="row">
          <div class="col-md-2 center">
            <div class="header-title">Author</div>
            <span class="grey"> {{proposal.authorStatus(proposal.data)}}</span>
            <div>
              <img class="avatar-big border-gray {{proposal.data.authorStatus}}-glow" src="{{proposal.data.authorPicture}}" alt="..."/>
            </div>
            <a href=""><h5 class="title same-line">{{proposal.data.authorName}}</h5></a>
          </div>
          <div class="col-md-2 center">
            <div class="header-title">Receiver</div>
            <span class="grey"> {{proposal.receiverStatus(proposal.data)}}</span>
            <div>
              <img class="avatar-big border-gray {{proposal.data.receiverStatus}}-glow" src="{{proposal.data.receiverPicture}}" alt="..."/>
            </div>
            <a href=""><h5 class="title same-line">{{proposal.data.receiverName}}</h5></a>
          </div>
          <div class="col-md-2">
            <div class="header-title">ETA:</div>
            <span ng-show="!proposal.editingTime">{{proposal.data.ETA}}
              <button rel="tooltip" title="Edit" ng-click="proposal.flipTimeEditingStatus()" class="btn btn-danger btn-simple btn-xs">
                <i class="fa fa-edit"></i>
              </button>
            </span>
            <div class="card" ng-show="proposal.editingTime">
              <div class="content">
                <label>Date</label>
                <div class="form-group" ng-click="proposal.showDatePicker()">
                  <div class="input-group">
                    <input type="text" class="form-control" ng-model="proposal.selectedDate" readonly name="editDate" required-field>
                    <span class="input-group-addon"><span class="fa fa-calendar"></span></span>
                  </div>
                </div>
                <label>Time</label>
                <div class="form-group" ng-click="proposal.showTimePicker()">
                  <div class="input-group">
                    <input type="text" class="form-control" ng-model="proposal.selectedTime" readonly name="editTime" required-field>
                    <span class="input-group-addon"><span class="fa fa-clock-o"></span></span>
                  </div>
                </div>
                <button ng-disabled="editProposalForm.editDate.$invalid || editProposalForm.editTime.$invalid" type="submit" ng-click="proposal.saveTime()" class="btn btn-info btn-fill">Save</button>
              </div>
            </div>
            <div class="header-title" style="margin-top: 20px">Location:</div>
            <div ng-show="!proposal.editingLocation">
              <span>{{proposal.data.location}}</span>
              <button rel="tooltip" title="Edit" ng-click="proposal.flipLocationEditingStatus()" class="btn btn-danger btn-simple btn-xs">
                <i class="fa fa-edit"></i>
              </button>
            </div>
            <div ng-show="proposal.editingLocation">
              <input type="text" class="form-control form-group" ng-keydown="$event.keyCode === 13 && proposal.saveLocation(proposal.data.location)" ng-model="proposal.data.location" name="editLocation" required-field>
              <button ng-disabled="editProposalForm.editLocation.$invalid" type="submit" ng-click="proposal.saveLocation(proposal.data.location)" class="btn btn-info btn-fill">Save</button>
            </div>
          </div>
          <div class="col-md-2">
            <button ng-show="proposal.data.status != 'open'" style="margin-bottom: 10px; border-width: 1px; border-color: brown; color: brown" class="btn btn-social btn-outline" ng-click="proposal.markTaskAsReopened()">
              <i class="pe-7s-refresh"></i>
              Reopen
            </button>
            <button ng-show="proposal.data.status != 'done' && !proposal.data.archived" style="margin-bottom: 10px; border-width: 1px; border-color: green; color: green" class="btn btn-social btn-outline" ng-click="proposal.markTaskAsDone()">
              <i class="pe-7s-like2"></i>
              Done
            </button>
            <br/>
            <button ng-show="proposal.data.status != 'cancelled' && !proposal.data.archived" style="border-color: red; border-width: 1px; color: red" class="btn btn-social btn-outline" ng-click="proposal.markTaskAsCancelled()">
              <i class="pe-7s-trash"></i>
              Cancel
            </button>
          </div>
        </div>
        <div class="row" style="margin-top: 30px">
          <div class="col-md-8">
            <textarea style="padding-left: 30px;" ng-disabled="!proposal.editingDescription" class="form-control form-group" ng-keydown="$event.keyCode === 13 && proposal.saveDescription(proposal.data.text)" ng-model="proposal.data.text" name="editDescription" required-field>
            </textarea>
          </div>
          <button ng-show="!proposal.editingDescription" rel="tooltip" title="Edit" ng-click="proposal.flipDescriptionEditingStatus()" class="btn btn-danger btn-simple btn-xs">
            <i class="fa fa-edit"></i>
          </button>
          <button ng-show="proposal.editingDescription" ng-disabled="editProposalForm.editDescription.$invalid" type="submit" ng-click="proposal.saveDescription(proposal.data.text)" class="btn btn-info btn-fill">Save</button>
        </div>
        <div class="row" ng-show="proposal.currentUserIsInDoubt" style="margin-bottom: 20px; margin-left: 2px">
          <button type="submit" style="background-color: #18ce0f" ng-click="proposal.approveTask()" class="btn btn-info btn-fill">{{proposal.acknowledgeLabel}}</button>
        </div>
        <div class="row" style="padding-left: 15px; padding-right: 27px;" ng-show="proposal.data.activity.length > 0">
          <div class="card col-md-8">
            <div class="header" style="{{proposal.activityShowed ? '':'padding-bottom:15px;'}} cursor: pointer;" ng-click="proposal.flipActivityShowingStatus()">
              <i class="pe-7s-{{proposal.activityShowed ? 'close-circle': 'plus'}}"></i>
              <span class="title" style="padding-left:5px">Activity log</span>
            </div>
            <div class="content" ng-show="proposal.activityShowed">
              <hr style="margin-top: 10px">
              <div ng-repeat="activityRecord in proposal.data.activity | orderBy:'-time'">
                <b>{{(activityRecord.actor === proposal.currentUser) ? 'You' : activityRecord.actorName }}</b> changed <b>{{activityRecord.field}}</b> from '{{proposal.display(activityRecord.oldValue)}}' to '{{proposal.display(activityRecord.newValue)}}'.
              </div>
            </div>
          </div>
        </div>
        <div class="row" style="padding-left: 15px; padding-right: 27px;">
          <div class="card col-md-8">
            <div class="header" style="{{proposal.commentsShowed ? '':'padding-bottom:15px;'}} cursor: pointer;" ng-click="proposal.flipCommentsShowingStatus()">
              <i class="pe-7s-{{proposal.commentsShowed ? 'close-circle': 'plus'}}"></i>
              <span class="title" style="padding-left:5px">Comments</span>
              <hr style="margin-top: 10px">
            </div>
            <div class="content pre-scrollable" ng-show="proposal.commentsShowed">
              <div ng-repeat="comment in proposal.data.comments | orderBy:'-time'">
                <div class="alert alert-info col-md-8 col-md-offset-{{comment.author === proposal.currentUser ? '4' : '0'}}" style="margin-bottom: 0px; {{comment.author === proposal.currentUser ? '' : 'background-color: #4091e2'}}">
                  <span>{{comment.text}}</span>
                </div>
                <div class="col-md-3 col-md-offset-{{comment.author === proposal.currentUser ? '9' : '5'}}" style="margin-bottom: 20px; color: #9A9A9A; text-align: right;">
                  {{comment.formattedTime}}
                </div>
              </div>
            </div>
            <hr style="margin-top: 10px">
            <div class="content" ng-show="proposal.commentsShowed" style="padding-top: 0px">
              <textarea placeholder="Enter your comment..." style="padding-left: 30px;" class="form-control form-group" ng-keydown="$event.keyCode === 13 && proposal.addComment()" ng-model="proposal.comment" name="addComment" required-field>
              </textarea>
              <button ng-disabled="editProposalForm.addComment.$pristine || editProposalForm.addComment.$invalid" type="submit" ng-click="proposal.addComment()" class="btn btn-info btn-fill pull-right" style="margin-bottom: 15px">Add comment</button>
            </div>
          </div>
        </div>
        </form>
      </div>
    </div>
</ion-view>